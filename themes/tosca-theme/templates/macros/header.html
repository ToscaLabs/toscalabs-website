{% import "macros/general.html" as general %}

{%- macro header(config, lang, permalink) -%}

{% set nav_items = config.extra.nav_items %}
{%- if lang and lang != config.default_language -%}
    {% set nav_key = "nav_items_" ~ lang %}
    {%- if config.extra[nav_key] -%}
        {% set nav_items = config.extra[nav_key] %}
    {%- endif -%}
{%- endif -%}

{%- set map = config.extra.github_map -%}
{%- set default_lang = config.default_language -%}
{%- set github_description = general::parse_lang_map(map=map, default_lang=default_lang, lang=lang) -%}

  <header class="header">
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <a href="{{ get_url(path="/", lang=lang) }}">
                    <img src="{{ get_url(path='svg/logo.svg') | safe }}" alt="{{ config.title }}" class="logo">
                </a>
            </div>
            <div class="nav-menu">
                <ul class="nav-voices">
                  {%- if nav_items -%}
                    {% for item in nav_items %}
                    <li>
                      {% set nav_link_selected = "" -%}
                      {%- if permalink != "" -%}
                          {%- set split_values = permalink | split(pat="/") -%}
                          {%- set len = split_values | length -%}
                          {%- if item.url == "/" and item.prefix == "" and len == 4 -%}
                             {%- set nav_link_selected = " nav-link-selected" -%}
                          {%- elif item.url == "/" and item.prefix != "" and len == 5 -%}
                             {%- set nav_link_selected = " nav-link-selected" -%}
                          {%- else -%}
                              {%- set last_value = split_values | nth(n=len-2) -%}
                              {%- set last_part = "/" ~ last_value -%}
                              {%- if item.url == last_part -%}
                                 {%- set nav_link_selected = " nav-link-selected" -%}
                              {%- endif -%}
                          {%- endif -%}
                      {%- endif -%}
                      <a href="{{ item.prefix ~ item.url | safe }}" class="nav-link{{ nav_link_selected }}">{{ item.name }}</a>
                    </li>
                    {%- endfor -%}
                  {% endif %}
                </ul>
                <div class="nav-controllers">
                    <a href="{{ config.extra.github_link | safe }}" target="_blank" rel="noopener noreferrer" aria-label="{{ github_description  | trim }}">
                        <svg class="github-mark" width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
                          <path fill-rule="evenodd" clip-rule="evenodd" d="M 10.008275,0 C 4.4739572,0 0,4.5833142 0,10.253499 c 0,4.532481 2.8666186,8.369131 6.8433784,9.727042 0.4971974,0.102083 0.6793188,-0.220624 0.6793188,-0.492081 0,-0.237707 -0.016389,-1.052495 -0.016389,-1.90145 -2.7840596,0.611247 -3.363816,-1.222287 -3.363816,-1.222287 -0.4474162,-1.188328 -1.1103461,-1.493744 -1.1103461,-1.493744 -0.9112213,-0.628122 0.066375,-0.628122 0.066375,-0.628122 1.0107837,0.06792 1.5411686,1.052496 1.5411686,1.052496 0.8946276,1.56166 2.3362337,1.120412 2.9161949,0.848746 0.082764,-0.66208 0.3480587,-1.120412 0.6297425,-1.374994 C 5.9651397,14.531398 3.628906,13.648693 3.628906,9.7101677 c 0,-1.120412 0.3974302,-2.0370748 1.0271726,-2.7499885 C 4.5567206,6.705597 4.2086624,5.652893 4.7556406,4.2439406 c 0,0 0.8450512,-0.2716655 2.7504624,1.0524956 a 9.6223166,9.7853757 0 0 1 2.502172,-0.3395819 c 0.845051,0 1.706491,0.1189578 2.501966,0.3395819 1.905616,-1.3241611 2.750667,-1.0524956 2.750667,-1.0524956 0.546979,1.4089524 0.198715,2.4616564 0.09936,2.7162386 0.646336,0.7129137 1.027377,1.6295765 1.027377,2.7499885 0,3.9385253 -2.336234,4.8041463 -4.573315,5.0589373 0.364653,0.322499 0.679319,0.933538 0.679319,1.901242 0,1.374994 -0.01639,2.478531 -0.01639,2.817905 0,0.271665 0.182326,0.594372 0.679319,0.492498 3.97676,-1.358328 6.843378,-5.19477 6.843378,-9.727251 C 20.016344,4.5833142 15.525998,0 10.008275,0 Z" />
                        </svg>
                    </a>
                {%- if config.languages | length > 0 -%}
                    {%- for lang_code, lang_config in config.languages -%}
                        {%- if lang_code != lang -%}
                            {%- set link = get_url(path="/", lang=lang_code) -%}
                            {%- if page is defined and page.translations -%}
                                {% set translation = page.translations | filter(attribute="lang", value=lang_code) | first %}
                                {%- if translation -%}
                                    {% set link = translation.permalink %}
                                {%- endif -%}
                            {%- elif section is defined and section.translations -%}
                                {% set translation = section.translations | filter(attribute="lang", value=lang_code) | first %}
                                {%- if translation -%}
                                    {% set link = translation.permalink %}
                                {%- endif -%}
                            {% endif %}
                    <a href="{{ link | safe }}" class="multilang-link">{{ lang_code }}</a>
                        {%- endif -%}
                    {% endfor %}
                {%- endif %}
                </div>
            </div>
            <div class="burger-menu" id="burger-menu">
                <span class="bar bar-1"></span>
                <span class="bar bar-2"></span>
                <span class="bar bar-3"></span>
            </div>
        </div>
    </nav>
  </header>
{%- endmacro header -%}
